# Тестирование AI Code Assistant

## Что реализовано

✅ **Настройки API провайдеров**
- Поддержка Google Gemini, OpenAI, OpenRouter, Custom API
- Интерфейс выбора провайдера с карточками
- Поля для ввода API ключей с скрытием/показом
- Ручной ввод названия модели
- Настройки Custom URL для кастомных API
- Автоматическое сохранение в localStorage
- Валидация конфигурации

✅ **Отправка запросов к AI**
- Формирование запроса с учетом выбранного шаблона
- Отправка содержимого выбранных файлов
- Обработка ответов от AI
- Индикаторы загрузки и ошибок

## Как протестировать

### 1. Запуск в режиме разработки

1. Откройте проект в VS Code
2. Нажмите **F5** или **Run Extension** в панели Debug
3. Откроется новое окно VS Code (Extension Development Host)
4. В новом окне откройте любую папку с проектом
5. Откройте панель команд (**Ctrl+Shift+P**) и выполните команду `AI Assistant: Open Panel`

### 2. Проверка настроек API

1. В открывшейся панели найдите секцию **"Настройки API"**
2. Кликните на заголовок для раскрытия
3. Проверьте:
   - Выбор провайдера (Google Gemini, OpenAI, OpenRouter, Custom API)
   - Ввод API ключа с кнопкой показа/скрытия
   - Поле ввода модели (вручную)
   - Для Custom API - поле URL
   - Индикатор валидности настроек (✓/⚠)

### 3. Проверка отправки запроса

1. Настройте API ключ для любого провайдера
2. Выберите файлы в дереве файлов (левая панель)
3. Введите запрос в поле "Ваш запрос"
4. Нажмите "Отправить"
5. Проверьте:
   - Появление индикатора загрузки
   - Получение ответа от AI
   - Возможность сохранения ответа в файл

### 4. Тестирование различных провайдеров

#### Google Gemini
- Провайдер: `Google Gemini`
- Модель: `gemini-1.5-pro` или `gemini-1.5-flash`
- API ключ: получить на https://aistudio.google.com/

#### OpenAI
- Провайдер: `OpenAI`
- Модель: `gpt-4` или `gpt-3.5-turbo`
- API ключ: получить на https://platform.openai.com/

#### OpenRouter
- Провайдер: `OpenRouter`
- Модель: `anthropic/claude-3-sonnet` или другие доступные
- API ключ: получить на https://openrouter.ai/

#### Custom API
- Провайдер: `Custom API`
- URL: ваш API сервер, совместимый с OpenAI API
- Модель: любая поддерживаемая вашим сервером

### 5. Проверка персистентности

1. Настройте API ключи и выберите провайдер
2. Введите текст запроса
3. Закройте панель расширения
4. Откройте заново - настройки должны сохраниться

### 6. Проверка ошибок

1. Введите неверный API ключ
2. Попробуйте отправить запрос
3. Убедитесь, что ошибка корректно отображается

## Известные ограничения

- Размер файлов ограничен контекстом модели
- Некоторые API имеют rate limits
- Custom API должен быть совместим с OpenAI API

## Исправленные проблемы

✅ **Ошибка VS Code API**: "An instance of the VS Code API has already been acquired"
- Проблема: VS Code API вызывался несколько раз через `acquireVsCodeApi()`
- Решение: API теперь получается только один раз при инициализации AppStore и переиспользуется

✅ **Ошибка сериализации**: "Failed to execute 'postMessage' - could not be cloned"
- Проблема: MobX observable объекты содержат внутренние ссылки и функции, которые нельзя передать через postMessage
- Решение: Все объекты теперь сериализуются в plain objects перед отправкой, добавлена автоматическая сериализация через JSON

✅ **Ошибка сохранения файла**: "Cannot read properties of undefined (reading 'content')"
- Проблема: ResponseSection отправлял сообщение saveResponse в неправильном формате
- Решение: Исправлен формат сообщения - данные теперь передаются в поле `data.content`

## Следующие шаги

- [ ] Тестирование всех провайдеров с реальными API ключами
- [ ] Проверка работы с большими файлами
- [ ] Тестирование системы шаблонов
- [ ] UI/UX улучшения
- [ ] Обработка edge cases 